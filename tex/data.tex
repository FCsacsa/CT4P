
\section{Initial Algebras and Inductive Datatypes}
\label{sec:initial-algs}

\begin{reading*}
  This chapter is strongly inspired by Varmo Vene's Ph.D.\ thesis \cite[Chapter 2]{vene_phd}.

  A good explanation recursion on lists is given in Graham Hutton's tutorial paper \cite{DBLP:journals/jfp/Hutton99}.
\end{reading*}

In this section we introduce (initial) algebras which allows us to define inductive data types.

\begin{dfn} Let $F:\CC\to \CC$ be an endofunctor. An \textbf{$F$-algebra} consists of the following data:
\begin{enumerate}
\item An object $C\in \CC$.
\item A morphism $\phi \in \CHom{\CC}{F(C)}{C}$.
\end{enumerate}
\end{dfn}

\begin{intu} An algebra is loosely speaking a set with some \textit{algebraic} operations like multiplication. A simple example is that of a monoid. The following example shows that (the data of) monoids correspond precisely with algebras over a fixed endofunctor.
\end{intu}


\begin{exa}
 Let $\Maybe : \SET \to \SET$ be the endofunctor given on objects by $\Maybe(X) := 1 + X$. 
 A $\Maybe$-algebra is a pair $(X,\phi)$ of a set $X$ and a function $\phi : 1 + X \to X$.
 By the universal property of the coproduct, $\phi$ is given, equivalently,
 by two functions $z$ and $s$ as follows.
 \begin{align*}
    z : 1 &\to X
    \\
    s : X &\to X
 \end{align*}
Here, think of ``$z$'' standing for ``zero'', and ``$s$'' standing for ``successor''.
\end{exa}


\begin{exa}\label{example:algebra_of_monoids} Let $F$ be the endofunctor induced by:
\[
F: \SET \to \SET: X \mapsto 1 + (X\times X).
\]
An $F$-algebra consists of a set $X\in\SET$ together with a function $\phi:\CHom{\SET}{1\sqcup (X\times X)}{X}$. Since $\phi$ is function from the disjoint union, we have that $\phi$ corresponds uniquely to two functions:
\begin{align*}
e &: 1\to X
\\
m &: X\times X\to X.
\end{align*}
This is precisely the data of a monoid.

Conversely, if $(M,m,e)$ is a monoid, then this induces a function
\[
1 + (M\times M) \xrightarrow{\phi} M,
\]
which is defined by 
\begin{align*}
\phi\vert_{1} : 1 &\to M
\\
\star &\mapsto e
\\
\phi\vert_{M\times M} : M\times M &\to M 
\\
(x,y) &\mapsto m(x,y)
\end{align*}
The pair $(M, \phi)$ is an $F$-algebra.

\end{exa}

\begin{rem}
 Note that a monoid $(M,m,e)$ also satisfies some laws.
 The laws are not expressed in \cref{example:algebra_of_monoids}.
 To incorporate the laws, one studies instead algebras of a monad.
\end{rem}


\begin{dfn}\label{dfn:alg-hom}
Let $F:\CC\to \CC$ be an endofunctor and $(C,\phi)$ and $(D,\psi)$ be $F$-algebras. 
A \textbf{($F$-algebra) homomorphism} from $(C,\phi)$ to $(D,\psi)$ is a morphism $f\in \CHom{\CC}{C}{D}$ such that the following diagram commutes:
\[
\begin{tikzcd}
FC
\arrow[r, "\phi"] 
\arrow[d,swap, "Ff"]
& C 
\arrow[d, "f"] 
\\
FD
\arrow[r, swap, "\psi"] 
& D
\end{tikzcd}
\]
\end{dfn}



\begin{exer} 
Let $F$ be the endofunctor defined as in \cref{example:algebra_of_monoids}, 
i.e. the endofunctor whose algebras corresponds with monoids. 
Characterize the $F$-algebra homomorphisms.
\end{exer}

\begin{dfn}\label{definition:category_of_Falgebras} Let $F:\CC\to \CC$ be an endofunctor. The \textbf{category of $F$-algebras}, denoted by $\ALG{F}$, is defined by the following data:
\begin{itemize}
\item The objects are the $F$-algebras.
\item The morphisms are the $F$-algebra homomorphisms.
\item The identity on $(C,\phi)$ is given by the identity $\Id[C]$ in $\CC$.
\item The composition is given by the composition of morphisms in $\CC$.
\end{itemize}
\end{dfn}

\begin{exer}
  \begin{enumerate}
  \item Draw two diagrams to illustrate \cref{definition:category_of_Falgebras}.
  \item Show that $\ALG{F}$ satisfies the properties of a category.
  \end{enumerate}
\end{exer}

We are interested in \textbf{initial objects of $\ALG{F}$}, if they exist.
We call these ``initial $F$-algebras''.
For a general endofunctor $F$, an initial $F$-algebra does not exist;
but for many interesting choices of $F$, such an initial object does exist.
Before coming to the general definition (see \cref{dfn:initial-alg}),
we consider an example.


\begin{exer}
  Consider the functor $\Maybe : \SET \to \SET$.
  \begin{enumerate}
  \item Show that the initial $\Maybe$-algebra is given by the pair $(\NN, [\Zero,\Succ])$, 
    where $\NN$ is the set of natural numbers, and $\Zero : 1 \to \NN$ and $\Succ : \NN\to\NN$ 
    are the function picking out zero and the successor function, respectively.
  \item Given any other $\Maybe$-algebra $(X,[z,s])$, unpack what it means for the square of \cref{dfn:alg-hom} to commute.
  \item Compare the data from the previous exercise to a definition of a function $f : \NN \to X$ by pattern matching (e.g., in Haskell).
  \end{enumerate}
\end{exer}



\begin{dfn}\label{dfn:initial-alg}
  Let $F:\CC\to\CC$ be an endofunctor. An \textbf{initial $F$-algebra} (if it exists) is an initial object in $\ALG{F}$.
  Unfolding the definition, this means that it is an $F$-algebra $(\Initalg{F}, \In)$ such that for any $F$-algebra $(C,\phi)$, there exists a unique morphism $\catam{\phi} \in \CHom{\CC}{\Initalg{F}}{C}$ such that the following diagram commutes:
\begin{equation}\label{eq:initial-f-alg}
\begin{tikzcd}
{F\Initalg{F}} 
\arrow[r, "\In"] 
\arrow[d,swap, "F\catam{\phi}"]
& {\Initalg{F}} 
\arrow[d, "\catam{\phi}"] 
\\
FC
\arrow[r, swap, "\phi"] 
& C
\end{tikzcd}
\end{equation}
A morphism of the form $\catam{\phi}$ is called a \textit{catamorphism}.
\end{dfn}

\begin{exer}
  Let $F:\CC\to\CC$ be an endofunctor and let $(\Initalg F, \In)$ be an initial algebra. Show that
  \[\catam{\In} = \Id[\Initalg{F}].\]
\end{exer}

\begin{exer}[Fusion Property]\label{exer:fusion-property}
  Let $F:\CC\to\CC$ be an endofunctor and let $(\Initalg F, \In)$ be an initial algebra. Show that
  for $F$-algebras $(C,\phi)$ and $(D,\psi)$ and $f\in\CHom{\CC}{C}{D}$, we have 
\[
\co{\phi}{f} = \co{F(f)}{\psi} \implies \co{\catam{\phi}}{f} = \catam{\psi}.
\]
This is summarized in the following diagram:
\begin{equation}\label{eq:initial-f-alg-composition}
\begin{tikzcd}
F\Initalg{F} 
\arrow[r, "\In"] 
\arrow[d,swap, "F\catam{\phi}"]
\ar[dd, bend right=60, "F\catam{\psi}"']
&
\Initalg{F}
\arrow[d, "\catam{\phi}"]
\ar[dd, bend left=60, "\catam{\psi}"]
\\
FC
\arrow[r, swap, "\phi"]
\ar[d, "Ff"'] 
&
C \ar[d, "f"]
\\
FD \ar[r, "\psi"']
&
D
\end{tikzcd}
\end{equation}

\end{exer}

\begin{exer}[\textbf{Lambek's theorem}] Let $F:\CC\to\CC$ be an endofunctor and let $(\mu F, \In)$ be an initial algebra.
  Then $\In$ is an isomorphism whose inverse is given by $\Inv{\In} = \catam{F(\In)}$.
\end{exer}

\begin{exer}\label{exercise:initialalg_for_idfun_with_initialob} Let $\CC$ be a category with an initial object $\bot$. Show that $(\bot, \Id[\bot])$ is the initial algebra for the identity (endo)functor on $\CC$.
\end{exer}


\begin{exer}\label{exercise:initialalg_for_list}
  Let $A$ be a set and define $F$ to be the functor induced by 
\begin{align*}
  F_A:\SET &\to\SET
\\
  X &\mapsto 1 + (A\times X).
\end{align*}

\begin{enumerate}
\item \label{enum:list-alg} Show that an $F_A$-algebra consists of a triple $(X,n,c)$, where $X$ is a set, $n\in X$ is an element of $X$, and $c : A \times X \to X$ is a function.
\item Show that the initial $F_A$-algebra is given by the set $\List(A)$ of $A$-valued lists, together with constants $\nil \in \List(A)$ and $\cons : A \times \List(A) \to \List(A)$.
\item Given any other $F_A$-algebra $(X,n,c)$, unpack what it means for the square of \cref{dfn:alg-hom} to commute.
Compare it to a definition of a function $f : \List(A) \to X$ by pattern matching.
\end{enumerate}

\end{exer}

\begin{rem}
  In the case of lists, the operator $\catam{\_}$ is also known as |fold|, which in Haskell is defined as follows:
  \begin{lstlisting}
    fold            :: (a → b → b) → b → ([a] → b)
    fold f v   []   =  v
    fold f v (x:xs) =  f x (fold f v xs)
  \end{lstlisting}
  Compare the input of |fold| to the data of an $F_A$-algebra given in \cref{enum:list-alg} of \cref{exercise:initialalg_for_list}.
\end{rem}


\begin{exer}
  Define the following functions as a catamorphism, that is, using |fold|.
  In each case, draw the diagram corresponding to Diagram~\ref{eq:initial-f-alg} of \cref{dfn:initial-alg}.
  \begin{enumerate}
  \item |sum :: [Int] →  Int|
  \item |product :: [Int] →  Int|
  \item |and :: [Bool ] →  Bool|
  \item |or :: [Bool ] →  Bool|
  \item |(++) :: [a] →  [a] →  [a]|
  \item |length :: [a] →  Int|
  \item |reverse :: [a] →  [a]|
  \item |map :: (a →  b) →  ([a] →  [b])|
  \item |filter :: (a →  Bool ) →  ([a] →  [a])|
  \end{enumerate}
  Solutions are given in \cite{DBLP:journals/jfp/Hutton99}.
\end{exer}



\begin{exer}[{\cite[\S3.1]{DBLP:journals/jfp/Hutton99}}]
  Show that |(+1) . sum = fold (+) 1|, by showing that |(+1) . sum| makes Diagram~\ref{eq:initial-f-alg} of \cref{dfn:initial-alg} commute.
\end{exer}




\begin{exer}\label{exercise:initialalg_for_btree} Let $A$ be a set and define $F$ to be the functor induced by 
\[
F_A:\SET\to\SET : X\mapsto A \sqcup (X\times X).
\]
Show that the initial $F_A$-algebra is given by the set $BTree(A)$ of $A$-valued binary trees.
\end{exer}

\begin{rem} Notice that in \cref{exercise:initialalg_for_list} and \cref{exercise:initialalg_for_btree}, we can consider the functor $F_A$ as a bifunctor where we vary $A$, i.e.
\[
F: \SET\to \SET\to \SET: (A,X)\mapsto F_A(X).
\]
In particular, under the assumption that for every $A\in\SET$ the initial $F_A$-algebra exists, we can wonder if the assignment 
\[
\Ob{\SET} \to \Ob{\SET} : A\mapsto \mu F_A ,
\]
can be extended to a functor. The following exercise answers this question positively for arbitrary categories.
\end{rem}

\begin{exer} Let $F:\CC\to\CC\to\CC$ be a bifunctor such that for any object $A\in\CC$, the initial algebra for the functor induced by 
\[
F_A : \CC\to\CC : X\mapsto F(A,X),
\]
exists. Show how
\[
\Ob{\CC} \to \Ob{\CC} : A\mapsto \mu F_A ,
\]
induces a functor.
\end{exer}



\section{Fusion Property}

The fusion property of \cref{exer:fusion-property} can be used to ``fuse'' a composition of functions into one function, possibly leading to more efficient code.

We are going to exemplify this using the datatypes of lists and of natural numbers.
Recall that $(\NN, [\Zero,\Succ])$ is the initial $\Maybe$-algebra.
We also write $(+1)$ for $\Succ$.

\begin{reading*}
  The content of this section is very much inspired by \cite[\S3.2]{DBLP:journals/jfp/Hutton99}.
  You are strongly encouraged to read that section before reading the present section.
  In this section, we show how 
\end{reading*}

\begin{exer}[{\cite[\S3.2]{DBLP:journals/jfp/Hutton99}}]
  Show that |(+1) . sum = fold (+) 1|, by using the fusion property of \cref{exer:fusion-property}.
\end{exer}

\begin{solution}
  We also write $\sum$ for |sum|. Note that |sum| is defined as the catamorphism $\catam{[\Zero, (+)]}$.
  The situation is summarized in the following diagram
  
  \[
    \begin{tikzcd}[row sep = huge, column sep = huge]
      \{*\} + \NN \times \List(\NN)
      \ar[d, "\Id + \Id \times \sum" description]
      \ar[r, "{[\nil, \cons]}"]
      &
      \List(\NN)
      \ar[d, "\sum" description]
      \ar[dd, bend left, "\catam{[1, (+)]}"]
      \\
      \{*\} + \NN \times \NN
      \ar[r, "{[\Zero, (+)]}"]
      \ar[d, "{\Id + \Id \times (+1)}" description]
      &
      \NN
      \ar[d, "{(+1)}" description]
      \\
      \{*\} + \NN \times \NN
      \ar[r, "{[1, (+)]}"]
      &
      \NN 
    \end{tikzcd}
  \]

  In order to show that |(+1) . sum = fold (+) 1|, in the diagram expressed as $\co{\sum}{(+1)} = \catam{[1, (+)]}$, we need to show that the lower rectangle commutes---this is what  \cref{exer:fusion-property} says.

  There are two cases to consider: the case of $*$, and the case of a pair $(m,n) \in \NN\times\NN$.
  In the case of $*$, we obtain
  \[
    (+1)~0 = 1
  \]
  and in the case of $(m,n)$, we obtain
  \[
    (+1)~ ((+)~ m~ n) = (+)~ m~ ((+1)~n)
  \]
  both of which hold.
  
\end{solution}

\begin{exer}
  Prove that |map g . map f = map (g . f)| using the fusion property.
\end{exer}




\section{Terminal Coalgebras and Coinductive Datatypes}
In this section we introduce (terminal) coalgebras which allows us to define coinductive data types.

\begin{dfn} Let $F:\CC\to \CC$ be an endofunctor. An \textbf{$F$-coalgebra} consists of the following data:
\begin{itemize}
\item An object $C\in \CC$.
\item A morphism $\phi \in \CHom{\CC}{C}{F(C)}$.
\end{itemize}
\end{dfn}
Notice that an $F$-algebra consists of a morphism $F(C)\to C$, while an $F$-coalgebra consists of a morphism $C\to F(C)$ in the other direction.

\begin{dfn} Let $F:\CC\to \CC$ be an endofunctor and $(C,\phi)$ and $(D,\psi)$ be $F$-coalgebras. A \textbf{($F$-algebra) homomorphism} from $(C,\phi)$ to $(D,\psi)$ is a morphism $f\in \CHom{\CC}{C}{D}$ such that the following diagram commutes:
\begin{center}
\begin{tikzcd}
C 
\arrow[r, "\phi"] 
\arrow[d,swap, "f"]
& F(C) 
\arrow[d, "F(f)"] 
\\
D
\arrow[r, swap, "\psi"] 
& F(D) 
\end{tikzcd}
\end{center}
\end{dfn}

\begin{exer} Define the category $\COALG{F}$ of $F$-coalgebras analogously to the category $\ALG{F}$ of $F$-algebras (as in \cref{definition:category_of_Falgebras}).
\end{exer}

\begin{dfn} Let $F$ be an endofunctor on $\CC$. The \textbf{terminal $F$-coalgebra} is the terminal object in $\COALG{F}$ which we denote by $(\nu F, out)$.\\
For $(C,\phi)$ an arbitrary $F$-coalgebra, we denote the unique morphism $C\to \nu F$ by $\anam{\phi}$. and we call a morphism of this form an \textit{anamorphism} (instead of a catamorphism).
\end{dfn}

\begin{exer} Spell out what it means for a coalgebra to be the terminal coalgebra.
\end{exer}

\begin{exer} Let $F:\CC\to\CC$ be an endofunctor and assume that the terminal coalgebra $(\nu F, out)$ exists. Show that the following properties holds:
\begin{enumerate}
\item $\Id = \anam{out}$.
\item For $F$-algebras $(C,\phi)$ and $(D,\psi)$ and $f\in\CHom{\CC}{C}{D}$, we have 
\[
f\Comp\psi  = \phi\Comp F(f) \implies f\Comp\anam{\psi} = anam{\phi}.
\]
\end{enumerate} 
\end{exer}

\begin{exer} (\textbf{Dual Lambek's theorem}) Let $F:\CC\to\CC$ be an endofunctor and assume that the terminal coalgebra $(\nu F, out)$ exists. Then is $out$ an isomorphism whose inverse is given by $\Inv{out} = \anam{F(out)}$.
\end{exer}

\begin{exer}\label{exercise:terminalalg_for_idfun_with_terminalob} Let $\CC$ be a category with an terminal object $\top$. Then is $(\top, \Id[\top])$ the terminal coalgebra for the identity (endo)functor on $\CC$.
\end{exer}

\begin{exer} Let $F$ be the functor induced by 
\[
F:\SET\to\SET : X\mapsto 1 \sqcup X.
\]
Show that the terminal $F$-coalgebra is given by the following data:
\begin{itemize}
\item The underlying object is given by the set $\mathbb{N} \sqcup \{\infty\}$ of natural numbers with infinity.
\item The underlying function is given by the predecessor defined as follows: 
\begin{align*}
\mathbb{N} \sqcup \{\infty\} &\to 1 \sqcup \mathbb{N} \sqcup \{\infty\},\\
0 &\mapsto \star,\\
s(n) &\mapsto n,\\
\infty &\mapsto \infty,
\end{align*}
where $\star$ is the unique element of $1$.
\end{itemize}
\end{exer}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "CT4P"
%%% End:
